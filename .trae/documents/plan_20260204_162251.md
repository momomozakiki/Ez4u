# Update Rule Files with "MUST DO" Sections

## Goal
Align the `.trae/rules` files with `Unified_5_Layer_Architecture.md` by adding a strict `## ✅ MUST DO` section to each file, ensuring strict compliance with the architecture design while keeping each file under 1000 characters.

## Execution Steps

1.  **Update `nextjs-frontend-rules.md`**:
    *   Add `## ✅ MUST DO` section.
    *   Include: `'use client'` usage, L3 fetch for SSR, L2 calls for actions, Loading/Error states, Strict TS, Service Token headers.

2.  **Update `nextjs-bff-api-rules.md`**:
    *   Add `## ✅ MUST DO` section.
    *   Include: Zod validation, Auth before proxy, Forward headers (`X-User-ID`, `X-Tenant-ID`), Standard errors, N-1 compatibility.

3.  **Update `fastapi-backend-rules.md`**:
    *   Add `## ✅ MUST DO` section.
    *   Include: Pydantic V2, Dual Auth (JWT + Service Token), `tenant_id` validation/injection, Call L4 Business Logic, Structured errors, Trace ID propagation.

4.  **Update `python-business-logic-rules.md`**:
    *   Add `## ✅ MUST DO` section.
    *   Include: Framework-agnostic, Repository pattern, Tenant isolation, Transactions, Domain exceptions, Circuit breaker, Timeouts.

5.  **Update `sqlalchemy-orm-database-rules.md`**:
    *   Add `## ✅ MUST DO` section.
    *   Include: UUID v7 PKs, `tenant_id` columns, JSONB/GIN, Versioned migrations, Zero-downtime, RLS policies.

## Validation
*   Check that all new sections match the "Strict Protocol" from the unified document.
*   Verify each file size stays under 1000 characters.
*   Confirm "PROHIBITED" sections remain intact.